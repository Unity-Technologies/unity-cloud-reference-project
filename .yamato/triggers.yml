{% metadata_file .yamato/globals.metafile %}
---

nightly_reference_project_build:
  name: Nightly Builds
  variables:
    AAB_BUILD: false
  triggers:
    recurring:
      - branch: develop
        frequency: daily
  dependencies:
    - .yamato/utils.yml#increment_build_version

verify:
  name: Verify Commit
  agent:
    type: Unity::VM
    image: package-ci/ubuntu:stable
    flavor: b1.small
  triggers:
    branches:
      only:
        - develop
    pull_requests:
      - targets:
          only:
            - "/.*/"
  commands:
    - npm install upm-ci-utils@stable -g --registry {{ npm_artifactory }}
    - upm-ci package izon -t
  artifacts:
    logs:
      paths:
        - "upm-ci~/test-results/**/*"
    packages:
      paths:
        - "upm-ci~/packages/**/*"
  dependencies:
    - .yamato/reference-project/tests.yml#run_tests
    - .yamato/reference-project/build.yml#build_all

run_sonarqube:
  name: Run SonarQube
  triggers:
    branches:
      only:
        - develop
    pull_requests:
      - targets:
          only:
            - "/.*/"
  dependencies:
    - .yamato/sonarqube/sonarqube.yml#SonarQube_Dotnet_Scan
